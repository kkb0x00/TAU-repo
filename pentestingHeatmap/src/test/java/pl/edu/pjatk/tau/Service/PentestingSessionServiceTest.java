package pl.edu.pjatk.tau.Service;

import org.junit.Assert;
import org.junit.Before;
import pl.edu.pjatk.tau.Domain.PentestingSession;
import pl.edu.pjatk.tau.Exceptions.InvalidIdException;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

import static org.junit.Assert.*;

public class PentestingSessionServiceTest {
    private PentestingSessionService sessionService;
    private HashMap<Integer, PentestingSession> sessions;
    private PentestingSession firstSession = null;
    private PentestingSession secondSession = null;

    @Before
    public void setUp() {
        sessions = new HashMap<Integer, PentestingSession>();
        firstSession = new PentestingSession(30, 1);
        secondSession = new PentestingSession(50, 2);

        sessions.put(1, firstSession);
        sessions.put(2, secondSession);
        sessionService = new PentestingSessionService(sessions);
    }

    @org.junit.Test
    public void shouldReturnDatabaseObjectTest() {
        assertNotNull(sessionService.getDatabaseHandler());
    }

    @org.junit.Test
    public void shouldReturnFirstSessionFromDatabaseTest() {
        PentestingSession element = sessionService.get(1);
        assertEquals(element, firstSession);
    }

    @org.junit.Test
    public void shouldReturnLastSessionFromDatabaseTest() {
        PentestingSession element = sessionService.get(2);
        Assert.assertEquals(element, secondSession);
    }

    @org.junit.Test
    public void shouldReturnAllSessionsFromDatabaseTest() {
        List<PentestingSession> sessionsList = new ArrayList<PentestingSession>();
        sessionsList.add(firstSession);
        sessionsList.add(secondSession);

        List<PentestingSession> sessions = sessionService.getAll();
        Assert.assertEquals(sessions, sessionsList);
    }

    @org.junit.Test
    public void shouldAddPentestingSessionTest() {
        PentestingSession newSession = new PentestingSession(10,5);
        sessionService.add(newSession);

        Assert.assertEquals(sessionService.get(3), newSession);
        Assert.assertEquals(sessionService.getAll().size(), 3);
    }

    @org.junit.Test
    public void shouldUpdatePentestingSessionTest() throws InvalidIdException {
        PentestingSession updatedSession = new PentestingSession(40,1);

        sessionService.update(1, updatedSession);

        Assert.assertEquals(sessionService.get(1), updatedSession);
        Assert.assertNotEquals(sessionService.get(2), updatedSession);
    }

    @org.junit.Test(expected = InvalidIdException.class)
    public void shouldNotUpdatePentestingSessionWithNotExistingIdTest() throws InvalidIdException {
        PentestingSession updatedSession = new PentestingSession(40,1);
        sessionService.update(3, updatedSession);
    }

    @org.junit.Test
    public void shouldDeletePentestingSessionTest() {
        sessionService.delete(1);

        Assert.assertEquals(sessionService.getAll().size(), 1);
    }

    @org.junit.Test
    public void shouldNotDeletePentestingSessionWithNotExistingIdTest() {
        sessionService.delete(1);

        Assert.assertEquals(sessionService.getAll().size(), 1);
    }
}